---
import Layout from "@/layouts/Layout.astro";
import CommunitySidebar from "@/components/CommunitySidebar";
import PixelCurrentUser from "@/components/PixelCurrentUser";
import { getSession } from "auth-astro/server";
import "@/assets/styles/community-layout.css";
import "@/assets/styles/pixel-art.css";

interface Props {
  title?: string;
  description?: string;
  hideSidebar?: boolean;
}

const { title, description, hideSidebar = false } = Astro.props;
const session = await getSession(Astro.request);
---

<Layout
  title={title}
  description={description}
  mainClassname=""
  hideHeader
  hideFooter
>
  <div class={`s-ui-layout-base ${hideSidebar ? "no-sidebar" : ""}`}>
    <header class="appbar justify-between">
      <div class="flex items-center gap-4">
        <div
          class="w-10 h-10 bg-blue-600 border-4 border-blue-800 flex items-center justify-center shadow-lg"
        >
          <img
            src="/favicon.svg"
            alt="Icon"
            class="size-6 image-pixelated"
            style="image-rendering: pixelated;"
          />
        </div>
        <span class="pixel-heading text-xl text-white drop-shadow-md"
          >{title}</span
        >
      </div>

      <div class="flex gap-4 items-center">
        <PixelCurrentUser client:load user={session?.user || null} />
      </div>
    </header>

    {
      !hideSidebar && (
        <aside class="sidebar">
          <CommunitySidebar client:load />
        </aside>
      )
    }

    <main class="main" style={{ gridArea: "main" }}>
      <div class="h-full w-full pixel-inset overflow-y-auto text-gray-300">
        <slot />
      </div>
    </main>
  </div>
</Layout>
