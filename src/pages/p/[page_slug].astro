---
import Layout from "@/layouts/Layout.astro";
import { getCustomPageBySlug } from "@/utils/custom-pages";
import { LucideCalendar, LucideClock } from "lucide-preact";

const { page_slug: pageSlug } = Astro.params;

if (!pageSlug) {
  return new Response(null, { status: 404 });
}

const page = await getCustomPageBySlug(pageSlug);

console.log("Cargando página personalizada:", { page });

if (!page) {
  return new Response(null, { status: 404 });
}

// Opcional: Si tu CMS devuelve fecha, úsala. Si no, usa la fecha actual o elimínalo.
const formattedDate = new Date().toLocaleDateString("es-UY", {
  year: "numeric",
  month: "long",
  day: "numeric",
});
---

<Layout
  title={page.title}
  description={`Página oficial: ${page.title}`}
  mainClassname="bg-[#050505] min-h-screen relative overflow-x-hidden"
>
  {/* --- FONDO AMBIENTAL --- */}
  <div class="fixed inset-0 pointer-events-none z-0">
    <div
      class="absolute inset-0 bg-[url('/images/pattern-grid.svg')] opacity-[0.03]"
    >
    </div>
    <div
      class="absolute top-0 left-1/2 -translate-x-1/2 w-[1000px] h-[400px] bg-blue-900/10 blur-[120px] rounded-full"
    >
    </div>
  </div>

  <div class="relative z-10 max-w-7xl mx-auto px-6 py-20 mt-12">
    {/* --- HEADER DE LA PÁGINA --- */}
    <header
      class="text-center mb-16 animate-in fade-in slide-in-from-bottom-4 duration-700"
    >
      {/* Breadcrumb / Label pequeño */}
      <div
        class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/5 border border-white/10 text-white/40 text-xs font-mono uppercase tracking-widest mb-6"
      >
        <span>Salto Uruguay</span>
        <span class="text-white/20">•</span>
        <span>Información</span>
      </div>

      <h1
        class="text-5xl md:text-7xl font-anton text-white uppercase tracking-wide mb-6 leading-tight drop-shadow-2xl"
      >
        {page.title}
      </h1>

      {/* Meta info (Opcional) */}
      <div
        class="flex items-center justify-center gap-6 text-white/40 text-sm font-rubik"
      >
        <div class="flex items-center gap-2">
          <LucideCalendar size={14} />
          <span>Actualizado: {formattedDate}</span>
        </div>
        <div class="hidden md:block w-1 h-1 rounded-full bg-white/20"></div>
      </div>
    </header>

    {/* --- CONTENIDO (THE PAPER) --- */}
    <article
      class="relative animate-in fade-in slide-in-from-bottom-8 duration-1000 delay-150"
    >
      {/* Glow detrás del contenido */}
      <div
        class="absolute -inset-1 bg-gradient-to-b from-white/10 to-transparent blur-2xl opacity-20 pointer-events-none"
      >
      </div>

      <div
        class="relative bg-[#0a0a0a] border border-white/10 rounded-3xl p-8 md:p-12 lg:p-16 shadow-2xl"
      >
        {/* PROSE: Aquí está la magia del estilo del texto */}
        <div
          class="prose prose-lg prose-invert max-w-none
            
            /* Encabezados */
            prose-headings:font-anton prose-headings:uppercase prose-headings:tracking-wide prose-headings:text-white
            prose-h1:text-4xl prose-h1:mb-8
            prose-h2:text-3xl prose-h2:text-white/90 prose-h2:mt-12 prose-h2:border-b prose-h2:border-white/10 prose-h2:pb-4
            prose-h3:text-2xl prose-h3:text-white/80
            
            /* Texto base */
            prose-p:text-white/70 prose-p:font-rubik prose-p:leading-relaxed prose-p:text-lg
            
            /* Enlaces */
            prose-a:text-blue-400 prose-a:no-underline hover:prose-a:text-blue-300 hover:prose-a:underline prose-a:transition-colors
            
            /* Listas */
            prose-li:text-white/70 prose-li:marker:text-blue-500
            
            /* Citas */
            prose-blockquote:border-l-4 prose-blockquote:border-blue-500 prose-blockquote:bg-blue-900/10 prose-blockquote:py-2 prose-blockquote:px-6 prose-blockquote:rounded-r-lg prose-blockquote:text-blue-200 prose-blockquote:italic
            
            /* Código */
            prose-code:text-yellow-300 prose-code:bg-white/5 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:before:content-none prose-code:after:content-none
            prose-pre:bg-[#050505] prose-pre:border prose-pre:border-white/10
            
            /* Imágenes */
            prose-img:rounded-2xl prose-img:border prose-img:border-white/10 prose-img:shadow-xl prose-img:w-full
            
            /* Separadores */
            prose-hr:border-white/10 prose-hr:my-12"
          set:html={page.cookedHtml}
        />

        {/* Footer del artículo */}
        <div
          class="mt-16 pt-8 border-t border-white/5 flex justify-between items-center"
        >
          <a
            href="/"
            class="text-sm font-bold text-white/40 hover:text-white transition-colors uppercase tracking-widest"
          >
            ← Volver al inicio
          </a>
          <div class="size-8 opacity-20">
            <img src="/favicon.svg" alt="Logo" />
          </div>
        </div>
      </div>
    </article>
  </div>
</Layout>
