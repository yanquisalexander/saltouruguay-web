---
import Layout from "@/layouts/Layout.astro";
import { getSession } from "auth-astro/server";
import { actions } from "astro:actions";
import InboxList from "@/components/saltogram/direct/InboxList";

const session = await getSession(Astro.request);
if (!session) {
  return Astro.redirect("/");
}

const { data, error } = await Astro.callAction(
  actions.messages.getConversations,
  {}
);
const conversations = data?.conversations || [];
---

<Layout title="Mensajes - Saltogram">
  <div class="min-h-screen bg-[#18191a] pt-20 pb-10">
    <div class="max-w-2xl mx-auto px-4">
      <div
        class="bg-[#242526] rounded-xl border border-white/10 overflow-hidden min-h-[600px] flex flex-col"
      >
        <div
          class="p-4 border-b border-white/10 flex justify-between items-center"
        >
          <h1 class="text-xl font-bold text-white">Mensajes</h1>
          <a
            href="/comunidad/saltogram"
            class="text-blue-500 hover:underline text-sm">Volver</a
          >
        </div>

        <div class="flex-1 overflow-y-auto">
          {
            conversations.length === 0 ? (
              <div class="flex flex-col items-center justify-center h-full text-white/50 p-8 text-center">
                <p>No tienes mensajes aún.</p>
                <p class="text-sm mt-2">
                  Responde a una historia para iniciar una conversación.
                </p>
              </div>
            ) : (
              <InboxList conversations={conversations} client:load />
            )
          }
        </div>
      </div>
    </div>
  </div>
</Layout>
